<div class="loja-container">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">
        <h1>üõçÔ∏è Loja de Roupas</h1>
      </div>
      <div class="search-bar">
        <span class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <input 
            pInputText 
            type="text" 
            placeholder="Buscar produtos..."
            [(ngModel)]="busca"
            (input)="aplicarFiltros()"
          />
        </span>
      </div>
      <div class="header-actions">
        <p-button 
          icon="pi pi-shopping-cart" 
          severity="secondary" 
          text 
          (click)="openCart()"
        ></p-button>
        <p-button 
          icon="pi pi-user" 
          severity="secondary" 
          text 
          (click)="goToLogin()"
        ></p-button>
      </div>
    </div>
  </header>

  <!-- Filtros -->
  <section class="filters-section">
    <div class="filters-content">
      <div class="filter-group">
        <label>Categoria:</label>
        <p-dropdown 
          [options]="categorias" 
          [(ngModel)]="categoriaSelecionada"
          (onChange)="aplicarFiltros()"
          placeholder="Todas as categorias"
        ></p-dropdown>
      </div>
      
      <div class="filter-group">
        <label>Tamanho:</label>
        <p-dropdown 
          [options]="tamanhos" 
          [(ngModel)]="tamanhoSelecionado"
          (onChange)="aplicarFiltros()"
          placeholder="Todos os tamanhos"
        ></p-dropdown>
      </div>
      
      <div class="filter-group">
        <label>Cor:</label>
        <p-dropdown 
          [options]="cores" 
          [(ngModel)]="corSelecionada"
          (onChange)="aplicarFiltros()"
          placeholder="Todas as cores"
        ></p-dropdown>
      </div>
      
      <div class="filter-group">
        <label>Pre√ßo: R$ {{precoRange[0]}} - R$ {{precoRange[1]}}</label>
        <p-slider 
          [(ngModel)]="precoRange" 
          [range]="true" 
          [min]="0" 
          [max]="1000"
          (onChange)="aplicarFiltros()"
        ></p-slider>
      </div>
      
      <div class="filter-group">
        <p-button 
          label="Limpar Filtros" 
          severity="secondary" 
          text
          (click)="limparFiltros()"
        ></p-button>
      </div>
    </div>
  </section>

  <!-- Produtos em Destaque -->
  <section class="featured-section" *ngIf="getProdutosDestaque().length > 0">
    <div class="section-header">
      <h2>üåü Produtos em Destaque</h2>
    </div>
    <div class="products-grid">
      <div 
        class="product-card featured" 
        *ngFor="let produto of getProdutosDestaque()"
        (click)="abrirModal(produto)"
      >
        <div class="product-image">
          <img [src]="produto.imagem" [alt]="produto.nome">
          <div class="product-badge" *ngIf="produto.precoOriginal">
            <p-tag 
              [value]="'-' + calcularDesconto(produto.preco, produto.precoOriginal) + '%'" 
              severity="danger"
            ></p-tag>
          </div>
        </div>
        <div class="product-info">
          <h3>{{produto.nome}}</h3>
          <p class="product-description">{{produto.descricao}}</p>
          <div class="product-price">
            <span class="current-price">R$ {{produto.preco.toFixed(2).replace('.', ',')}}</span>
            <span class="original-price" *ngIf="produto.precoOriginal">
              R$ {{produto.precoOriginal.toFixed(2).replace('.', ',')}}
            </span>
          </div>
          <div class="product-colors">
            <span 
              class="color-dot" 
              *ngFor="let cor of produto.cor.slice(0, 3)"
              [style.background-color]="getColorValue(cor)"
            ></span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Todos os Produtos -->
  <section class="products-section">
    <div class="section-header">
      <h2>üì¶ Todos os Produtos ({{produtosFiltrados.length}})</h2>
    </div>
    
    <div class="products-grid" *ngIf="produtosFiltrados.length > 0">
      <div 
        class="product-card" 
        *ngFor="let produto of produtosFiltrados"
        (click)="abrirModal(produto)"
      >
        <div class="product-image">
          <img [src]="produto.imagem" [alt]="produto.nome">
          <div class="product-badge" *ngIf="produto.precoOriginal">
            <p-tag 
              [value]="'-' + calcularDesconto(produto.preco, produto.precoOriginal) + '%'" 
              severity="danger"
            ></p-tag>
          </div>
        </div>
        <div class="product-info">
          <h3>{{produto.nome}}</h3>
          <p class="product-category">{{produto.categoria}}</p>
          <div class="product-price">
            <span class="current-price">R$ {{produto.preco.toFixed(2).replace('.', ',')}}</span>
            <span class="original-price" *ngIf="produto.precoOriginal">
              R$ {{produto.precoOriginal.toFixed(2).replace('.', ',')}}
            </span>
          </div>
          <div class="product-actions">
            <p-button 
              label="Ver Detalhes" 
              size="small"
              (click)="abrirModal(produto); $event.stopPropagation()"
            ></p-button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="no-products" *ngIf="produtosFiltrados.length === 0">
      <p>üòî Nenhum produto encontrado com os filtros selecionados.</p>
      <p-button 
        label="Limpar Filtros" 
        (click)="limparFiltros()"
      ></p-button>
    </div>
  </section>

  <!-- Modal do Produto -->
  <p-dialog 
    [(visible)]="modalVisible" 
    [modal]="true" 
    [style]="{width: '90vw', maxWidth: '800px'}"
    (onHide)="fecharModal()"
  >
    <ng-template pTemplate="header">
      <h3>{{produtoSelecionado?.nome}}</h3>
    </ng-template>
    
    <ng-template pTemplate="content" *ngIf="produtoSelecionado">
      <div class="product-modal">
        <div class="product-gallery">
          <p-carousel 
            [value]="produtoSelecionado.imagens" 
            [numVisible]="1" 
            [numScroll]="1"
            [circular]="true"
            [autoplayInterval]="0"
          >
            <ng-template let-image pTemplate="item">
              <img [src]="image" [alt]="produtoSelecionado.nome" class="modal-image">
            </ng-template>
          </p-carousel>
        </div>
        
        <div class="product-details">
          <h2>{{produtoSelecionado.nome}}</h2>
          <p class="description">{{produtoSelecionado.descricao}}</p>
          
          <div class="price-section">
            <div class="current-price">R$ {{produtoSelecionado.preco.toFixed(2).replace('.', ',')}}</div>
            <div class="original-price" *ngIf="produtoSelecionado.precoOriginal">
              R$ {{produtoSelecionado.precoOriginal.toFixed(2).replace('.', ',')}}
            </div>
            <div class="discount" *ngIf="produtoSelecionado.precoOriginal">
              {{calcularDesconto(produtoSelecionado.preco, produtoSelecionado.precoOriginal)}}% OFF
            </div>
          </div>
          
          <div class="product-options">
            <div class="option-group">
              <label>Tamanhos Dispon√≠veis:</label>
              <div class="size-options">
                <span 
                  class="size-option" 
                  *ngFor="let tamanho of produtoSelecionado.tamanho"
                >
                  {{tamanho}}
                </span>
              </div>
            </div>
            
            <div class="option-group">
              <label>Cores Dispon√≠veis:</label>
              <div class="color-options">
                <span 
                  class="color-option" 
                  *ngFor="let cor of produtoSelecionado.cor"
                  [style.background-color]="getColorValue(cor)"
                >
                  {{cor}}
                </span>
              </div>
            </div>
          </div>
          
          <div class="product-actions">
            <p-button 
              label="Adicionar ao Carrinho" 
              icon="pi pi-shopping-cart"
              size="large"
              (click)="addToCart(produtoSelecionado)"
            ></p-button>
            <p-button 
              label="Favoritar" 
              icon="pi pi-heart"
              severity="secondary"
              text
              (click)="addToFavorites(produtoSelecionado)"
            ></p-button>
          </div>
        </div>
      </div>
    </ng-template>
  </p-dialog>
</div>